local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local localPlayer = Players.LocalPlayer
local PlayerGui = localPlayer:WaitForChild("PlayerGui")

-- Noclip variables and function
local noclipEnabled = false
local noclipConnection = nil

local function setNoclip(enabled)
    noclipEnabled = enabled
    
    if enabled then
        -- Enable noclip
        if noclipConnection then 
            noclipConnection:Disconnect() 
        end
        
        noclipConnection = RunService.Stepped:Connect(function()
            local character = localPlayer.Character
            if not character then return end
            
            for _, part in ipairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end)
    else
        -- Disable noclip
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
        
        local character = localPlayer.Character
        if character then
            for _, part in ipairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
    end
end

-- Create the GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "InstantStealScriptGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

-- Increase frame height to fit two buttons
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 250, 0, 195)  -- Increased height from 165 to 195
MainFrame.Position = UDim2.new(0.5, -125, 0.5, -97)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Visible = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 10)
MainCorner.Parent = MainFrame

local MainStroke = Instance.new("UIStroke")
MainStroke.Thickness = 2
MainStroke.Color = Color3.fromRGB(60, 60, 70)
MainStroke.Parent = MainFrame

-- TITLE BAR
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 36)
TitleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
TitleBar.BorderSizePixel = 0
TitleBar.Active = true
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = TitleBar

local Title = Instance.new("TextLabel")
Title.Text = "INSTANT STEAL"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 15
Title.TextColor3 = Color3.fromRGB(220, 220, 230)
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(1, -50, 1, 0)
Title.Position = UDim2.new(0, 12, 0, 0)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = TitleBar

-- CLOSE BUTTON
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 26, 0, 26)
CloseButton.Position = UDim2.new(1, -30, 0.5, -13)
CloseButton.Text = "×"
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 18
CloseButton.TextColor3 = Color3.fromRGB(220, 220, 230)
CloseButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
CloseButton.BorderSizePixel = 0
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- CONTENT (adjusted for two buttons)
local Content = Instance.new("Frame")
Content.BackgroundTransparency = 1
Content.Size = UDim2.new(1, -24, 1, -70)
Content.Position = UDim2.new(0, 12, 0, 42)
Content.Parent = MainFrame

-- Button list layout
local ButtonList = Instance.new("UIListLayout")
ButtonList.Padding = UDim.new(0, 8)
ButtonList.FillDirection = Enum.FillDirection.Vertical
ButtonList.HorizontalAlignment = Enum.HorizontalAlignment.Center
ButtonList.VerticalAlignment = Enum.VerticalAlignment.Top
ButtonList.SortOrder = Enum.SortOrder.LayoutOrder
ButtonList.Parent = Content

-- INSTANT STEAL BUTTON (GREEN)
local StealBtnFrame = Instance.new("Frame")
StealBtnFrame.Size = UDim2.new(1, 0, 0, 40)
StealBtnFrame.LayoutOrder = 1
StealBtnFrame.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
StealBtnFrame.BorderSizePixel = 0
StealBtnFrame.Parent = Content

local StealBtnCorner = Instance.new("UICorner")
StealBtnCorner.CornerRadius = UDim.new(0, 8)
StealBtnCorner.Parent = StealBtnFrame

local StealBtn = Instance.new("TextButton")
StealBtn.Size = UDim2.new(1, 0, 1, 0)
StealBtn.BackgroundTransparency = 1
StealBtn.Text = "TELEPORT TO BASE"
StealBtn.Font = Enum.Font.GothamBold
StealBtn.TextSize = 14
StealBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
StealBtn.TextStrokeColor3 = Color3.new(0, 0, 0)
StealBtn.TextStrokeTransparency = 0.5
StealBtn.Parent = StealBtnFrame

-- NOCLIP BUTTON (PURPLE)
local NoclipBtnFrame = Instance.new("Frame")
NoclipBtnFrame.Size = UDim2.new(1, 0, 0, 40)
NoclipBtnFrame.LayoutOrder = 2
NoclipBtnFrame.BackgroundColor3 = Color3.fromRGB(120, 80, 200)  -- Purple color
NoclipBtnFrame.BorderSizePixel = 0
NoclipBtnFrame.Parent = Content

local NoclipBtnCorner = Instance.new("UICorner")
NoclipBtnCorner.CornerRadius = UDim.new(0, 8)
NoclipBtnCorner.Parent = NoclipBtnFrame

local NoclipBtn = Instance.new("TextButton")
NoclipBtn.Size = UDim2.new(1, 0, 1, 0)
NoclipBtn.BackgroundTransparency = 1
NoclipBtn.Text = "NOCLIP: OFF"
NoclipBtn.Font = Enum.Font.GothamBold
NoclipBtn.TextSize = 14
NoclipBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
NoclipBtn.TextStrokeColor3 = Color3.new(0, 0, 0)
NoclipBtn.TextStrokeTransparency = 0.5
NoclipBtn.Parent = NoclipBtnFrame

-- STATUS LABEL
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, -16, 0, 40)
StatusLabel.Position = UDim2.new(0, 8, 1, -45)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "Ready..."
StatusLabel.Font = Enum.Font.GothamBold
StatusLabel.TextSize = 10
StatusLabel.TextColor3 = Color3.fromRGB(170, 170, 180)
StatusLabel.TextWrapped = true
StatusLabel.TextYAlignment = Enum.TextYAlignment.Top
StatusLabel.Parent = MainFrame

-- Make GUI draggable
local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
end

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TitleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input == dragInput then
        update(input)
    end
end)

-- INSTANT STEAL FUNCTION
StealBtn.MouseButton1Click:Connect(function()
    StatusLabel.Text = "Searching for your base..."
    
    local spawnPart
    for _, plot in pairs(workspace.Plots:GetChildren()) do
        if plot:FindFirstChild("PlotSign") and plot.PlotSign:FindFirstChild("SurfaceGui") then
            local surfaceGui = plot.PlotSign.SurfaceGui
            if surfaceGui:FindFirstChild("Frame") and surfaceGui.Frame:FindFirstChild("TextLabel") then
                local textLabel = surfaceGui.Frame.TextLabel
                if textLabel.Text == localPlayer.DisplayName.."'s Base" then
                    spawnPart = surfaceGui.Parent.Parent:FindFirstChild("Spawn")
                    break
                end
            end
        end
    end

    if not spawnPart then
        StatusLabel.Text = "❌ Base not found!"
        task.wait(2)
        StatusLabel.Text = "Ready..."
        return
    end

    StatusLabel.Text = "Teleporting to base..."
    
    local char = localPlayer.Character or localPlayer.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    local humanoid = char:FindFirstChildOfClass("Humanoid")
    local target = spawnPart.CFrame + Vector3.new(0, 2, 0)

    for i = 1, 20 do
        hrp.CFrame = target
        task.wait()
    end

    humanoid.PlatformStand = true
    humanoid.AutoRotate = false
    hrp.AssemblyLinearVelocity = Vector3.new(0,0,0)
    hrp.AssemblyAngularVelocity = Vector3.new(0,0,0)

    local start = tick()
    while tick() - start < 2 do
        local x = (math.random() - 0.5) * 0.1
        local y = (math.random() - 0.5) * 0.1
        local z = (math.random() - 0.5) * 0.1
        hrp.CFrame = target * CFrame.Angles(x, y, z)
        task.wait(0.05)
    end

    humanoid.PlatformStand = false
    humanoid.AutoRotate = true
    StatusLabel.Text = "✅ Teleported to base!"
end)

-- NOCLIP FUNCTION
NoclipBtn.MouseButton1Click:Connect(function()
    setNoclip(not noclipEnabled)
    
    if noclipEnabled then
        NoclipBtnFrame.BackgroundColor3 = Color3.fromRGB(200, 100, 255)  -- Bright purple when ON
        NoclipBtn.Text = "NOCLIP: ON"
        StatusLabel.Text = "Noclip enabled - Walk through walls"
    else
        NoclipBtnFrame.BackgroundColor3 = Color3.fromRGB(120, 80, 200)  -- Dark purple when OFF
        NoclipBtn.Text = "NOCLIP: OFF"
        StatusLabel.Text = "Noclip disabled"
    end
end)

-- Clean up noclip when GUI is destroyed
ScreenGui.Destroying:Connect(function()
    setNoclip(false)
end)

print("INSTANT STEAL GUI WITH NOCLIP LOADED ✅")
